{
  "date": "2020-04-21T14:00:14.918Z",
  "title": "Displaying a Git commit SHA in your Nuxt.js application",
  "description": "#100DaysOfCode day 15",
  "categories": ["Nuxt.js", "JavaScript", "Vue.js", "#100DaysOfCode"],
  "body": "## Why?\n\nFor some applications it may be useful to know the current commit at the time of deployment. This information can be used in bug reports or to provide a link to the specific commit on GitHub.\n\n## The commit hash\n\nA git commit has a 40 character identifier that is usually referred to as the \"SHA\" or \"hash\". This is how you display the hash in your terminal.\n\n```shell\n$ git rev-parse HEAD\nf2faa06edfc89db696b6be4184f57e8d0cbe9d97\n```\n\nIt's possible to abbreviate the hash with the `--short` modifier.\n\n```shell\n$ git rev-parse --short HEAD\nf2faa06\n```\n\nYou can navigate to the commit on GitHub by appending the hash to this URL.\n\n```shell\nhttps://github.com/[username]/[reponame]/commit/f2faa06\n```\n\nIt will work with both the long and short version, as long as the commit has been pushed.\n\n## Setting an environment variable with the commit hash\n\nA Nuxt.js application knows nothing about its Git repository. That's why we will introduce a `current-git-sha` script and prepend it to `dev`, `build` and `generate`. Running the new script stores the output of `rev-parse` in a [\\`NUXT\\_ENV\\_\\` variable](https://nuxtjs.org/api/configuration-env#automatic-injection-of-environment-variables) which will then be injected into the application.\n\n```json\n// package.json\n{\n  \"name\": \"personal-website\",\n  \"scripts\": {\n    // New script\n    \"current-git-sha\": \"NUXT_ENV_CURRENT_GIT_SHA=`git rev-parse --short HEAD`\",\n    \n    // Runs the new script + original dev script\n    \"dev\": \"yarn run current-git-sha nuxt\",\n    \n    // Runs the new script + original build script\n    \"build\": \"yarn run current-git-sha nuxt build\",\n    \n    // Runs the new script + original generate script\n    \"generate\": \"yarn run git-env-sha nuxt generate\",\n    \n    \"start\": \"nuxt start\",\n    \"lint\": \"eslint --ext .js,.vue --ignore-path .gitignore .\",\n    \"test\": \"jest\"\n    }\n  }\n}\n```\n\nThe commit hash will now be available as `process.env.NUXT_ENV_CURRENT_GIT_SHA`. Here's how you would use it in a component. Note that at build-time the variable will be replaced with the hash.\n\n```html\n<template>\n  <footer>\n    <a :href=\"`https://github.com/[username]/[reponame]/commit/${commitSha}`\">\n      {{ commitSha }}\n    </a>\n  </footer>\n</template>\n\n<script>\n  export default {\n    data() {\n      return {\n        commitSha: process.env.NUXT_ENV_CURRENT_GIT_SHA\n      };\n    }\n  };\n</script>\n```\n\n## Notes & resources\n\n* Some hosting providers set this build environment variable for you. For example, [Netlify sets a 40 character SHA `COMMIT_REF` variable](https://docs.netlify.com/configure-builds/environment-variables/).\n* For the branch name, use `git rev-parse --abbrev-ref HEAD`\n* [git documentation for `git rev-parse`](https://git-scm.com/docs/git-rev-parse)\n* [Nuxt.js documentation for the env property](https://nuxtjs.org/api/configuration-env)\n\n- - -\n\n*This post was written as part of my #100DaysOfCode challenge, day 15.*"
}
